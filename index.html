
<!doctype html>
<html class="h-100" lang="en">

  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
      <title>DataViz/Assignment04</title>
      <link rel="stylesheet" href="css/theme.min.css">

   <style>
          .tooltip {
            background: rgb(0, 0, 0); /* box color */
            font-size: 14px;
            color: rgb(255, 255, 255);    /* font color */
            position: absolute;
            padding-top: 5px;
            padding-left: 5px;
            height: 75px;
            width: 175px;
            z-index: 1000;
            display: none; /* Initially hide the tooltip */
          }

          svg {
            display: block;
            stroke: black;
            stroke-width: 1px;
          }

       
          path {
            stroke: black; /* Set the stroke color explicitly for paths */
          }

          /* Define spectral color scheme for the map */
          rect:nth-child(1) { fill: #b7b4b3; } /* Line 29 */
          rect:nth-child(2) { fill: #fee0d2; } /* Line 30 */
          rect:nth-child(3) { fill: #fcbba1; } /* Line 31 */
          rect:nth-child(4) { fill: #fc9272; } /* Line 32 */
          rect:nth-child(5) { fill: #fb6a4a; } /* Line 33 */
          rect:nth-child(6) { fill: #ef3b2c; } /* Line 34 */
          rect:nth-child(7) { fill: #cb181d; } /* Line 35 */
          rect:nth-child(8) { fill: #a50f15; } /* Line 36 */
          rect:nth-child(9) { fill: #67000d; } /* Line 37 */
          rect:nth-child(10) { fill: #310003; } /* Line 38 */

          /* Legend text color and font size */
          #legend text {
        fill: white;
        font-size: 10px;
        font-weight: bold; /* Make the text bold */
          }

          

    </style>


  </head>

  <body class="bg-black text-white mt-0" data-bs-spy="scroll" data-bs-target="#navScroll">

    <nav id="navScroll" class="navbar navbar-dark bg-black fixed-top px-vw-5" tabindex="0">
  <div class="container">
    <a class="navbar-brand pe-md-4 fs-4 col-12 col-md-auto text-center" href="index.html">
  <span class="ms-md-1 mt-1 fw-bolder me-md-5">DataViz</span>
</a>

</li>

    </ul>
    
        <small>Assignment 04</small>
      </a>
</div>
</nav>

    <main>
      <div class="w-100 overflow-hidden position-relative bg-black text-white" data-aos="fade">
  <div class="position-absolute w-100 h-100 bg-black opacity-75 top-0 start-0"></div>
  <div class="container py-vh-4 position-relative mt-5 px-vw-5 text-center">
  <div class="row d-flex align-items-center justify-content-center py-vh-5">
    <div class="col-12 col-xl-10">
      <span class="h5 text-secondary fw-lighter"><br> Choropleth Map Vizualisation </span>
      <h1 class="display-huge mt-3 mb-3 lh-1" style="font-size: 48px;"> Singapore Population Density</h1>
    </div>
    <div class="col-12 col-xl-4">
      <p class="lead text-secondary" style="font-size: 24px;"><br>This interactive visualization explores population density across Singapore's subzones. 
        The map utilizes data from 2023 to reveal variations in population density throughout the country and leverages D3.js to create the choropleth map and visualize the population data.  
        <br><br>Viewers can explore how population density varies throughout Singapore, gaining insights into the urban fabric and demographic patterns of the city-state. 
        Hover over any subzone to reveal its name and population count. Each subzone is color-coded based on its population density, allowing for intuitive interpretation of spatial variations.
                    
      </p>
    </div>
  </div>
</div>

</div>


<svg viewBox="0 0 1000 600"></svg>
<div class="tooltip"></div> <!-- Tooltip div -->

<div id="legend">
  <svg width="400" height="50"> <!-- Adjust width here -->
    <g id="legendRect">
      <rect x="0" y="18" width="29" height="10" fill="#9e0142"></rect> <!-- Legend colors -->
      <rect x="29" y="18" width="29" height="10" fill="#d53e4f"></rect>
      <rect x="58" y="18" width="29" height="10" fill="#f46d43"></rect>
      <rect x="87" y="18" width="29" height="10" fill="#fdae61"></rect>
      <rect x="116" y="18" width="29" height="10" fill="#fee08b"></rect>
      <rect x="144" y="18" width="29" height="10" fill="#e6f598"></rect>
      <rect x="173" y="18" width="29" height="10" fill="#abdda4"></rect>
      <rect x="202" y="18" width="29" height="10" fill="#66c2a5"></rect>
      <rect x="231" y="18" width="29" height="10" fill="#3288bd"></rect>
      <rect x="260" y="18" width="29" height="10" fill="#5e4fa2"></rect>
    </g>
    <!-- Legend colors -->
    <g transform="translate(0,28)" fill="none" font-size="10" font-family="Segoe UI" text-anchor="middle">
      <g class="tick" opacity="1" transform="translate(29.5,0)">
        <line stroke="#fff5f0" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">10000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(58.5,0)">
        <line stroke="#fee0d2" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">20000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(87.5,0)">
        <line stroke="#fcbba1" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">30000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(116.5,0)">
        <line stroke="#fc9272" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">40000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(144.5,0)">
        <line stroke="#fb6a4a" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">50000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(173.5,0)">
        <line stroke="#ef3b2c" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">60000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(202.5,0)">
        <line stroke="#cb181d" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">70000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(231.5,0)">
        <line stroke="#a50f15" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">80000</text>
      </g>
      <g class="tick" opacity="1" transform="translate(260.5,0)">
        <line stroke="#67000d" y2="6" y1="-10"></line>
        <text fill="white" y="9" dy="0.71em">90000</text>
      </g>
    </g>
  </svg>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="lib/legend.js"></script>
<script>
  let width = 1000, height = 600;
  let legendwrapper = d3.select("#legend")
  let legendsvg = legendwrapper.select("svg")

legendwrapper.style("position", "absolute")
  .style("top", "175%")  // Adjust the top position as needed
  .style("left", "85%")
  .style("transform", "translateX(-50%)");

  let svg = d3.select("svg")
    .attr("viewBox", "0 0 " + width + " " + height)

  // Load external data and boot
  Promise.all([d3.json("https://chi-loong.github.io/HASS02.526/assignments/sgmap.json"),
    d3.csv("https://chi-loong.github.io/HASS02.526/assignments/population2023.csv")
  ]).then(data => {

    let mapFeatures = [];
    data[0].features.forEach(d => {
      let result = data[1].find(e => { return e["Subzone"].toUpperCase() == d.properties["Subzone Name"].toUpperCase(); })
      console.log("result =", result);
      let mapObject = d;
      if (result !== undefined) {
        if (result.Population !== "0") {
          mapObject.Population = result.Population;
        }
      }
      mapFeatures.push(mapObject);
    });

    // Map and projection
    var projection = d3.geoMercator()
      .center([103.851959, 1.290270])
      .fitExtent([[20, 20], [980, 580]], data[0]);

    let geopath = d3.geoPath().projection(projection);
    let colorScale = d3.scaleQuantize([1, 130000], d3.schemePuBu[9]);

    svg.append("g")
      .attr("id", "districts")
      .selectAll("path")
      .data(data[0].features)
      .enter()
      .append("path")
      .style("stroke-width", "0.5px")
      .style("stroke", "black")
      .attr("d", geopath)
      .attr("fill", d => {
        if (d.Population !== "0" && d.Population !== undefined && 90000 < d.Population) { return '#020000'; }
        if (80000 < d.Population) { return '#460000' }
        if (70000 < d.Population) { return '#780000' }
        if (60000 < d.Population) { return '#AB1212' }
        if (50000 < d.Population) { return '#BB2323' }
        if (40000 < d.Population) { return '#C93535' }
        if (30000 < d.Population) { return '#D64646' }
        if (20000 < d.Population) { return '#E15757' }
        if (10000 < d.Population) { return '#EA6969' }
        if (d.Population < 10000) { return '#F37A7A' }
        else return "grey";
      })
      .on("mouseover", (event, d) => {
        d3.select(event.currentTarget)
          .style('stroke', "white")
          .style("stroke-width", "3px");
        d3.select(".tooltip")
          .style("display", "block") // Show the tooltip
          .text(d.properties["Subzone Name"])
          .append("p")
          .text('Population: ' + d.Population)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 30) + "px");
      })
      .on("mousemove", (event) => {
        d3.select(".tooltip")
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 30) + "px");
      })
      .on("mouseout", (event, d) => {
        d3.select(event.currentTarget)
          .style('stroke', "white")
          .style('stroke-width', 0);
        d3.select(".tooltip")
          .style("display", "none") // Hide the tooltip
          .text("");
      });

    legend({
      title: popType + " Population",
      width: 360, // Adjust width of legend
      tickFormat: ".0f"
    });
  });


  
</script>
  
   
</div>

    </main>


    <footer class="bg-black border-top border-dark">
  <div class="container py-vh-4 text-secondary fw-lighter">
    <div class="row">
      <div class=" text-center text-center">
  <span class="ms-md-1 mt-1 fw-bolder me-md-5" style="font-size: 18px;">Moses Rux Jeba Mi Zerah <br></span>
  <span class="ms-md-1 mt-1 fw-bolder me-md-5" style="font-size: 12px;">  1008357 / MUSPP </span>                                           
  </span>
</a>







<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/aos.js"></script>
<script>
AOS.init({
 duration: 800, // values from 0 to 3000, with step 50ms
});
</script>
<script>
  let scrollpos = window.scrollY
  const header = document.querySelector(".navbar")
  const header_height = header.offsetHeight

  const add_class_on_scroll = () => header.classList.add("scrolled", "shadow-sm")
  const remove_class_on_scroll = () => header.classList.remove("scrolled", "shadow-sm")

  window.addEventListener('scroll', function() {
    scrollpos = window.scrollY;

    if (scrollpos >= header_height) { add_class_on_scroll() }
    else { remove_class_on_scroll() }

    console.log(scrollpos)
  })

  
</script>

  </body>
</html>
